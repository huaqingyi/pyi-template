{"version":3,"sources":["cluster.ts"],"names":[],"mappings":";;AAAA,qCAA6C;AAC7C,+CAA4C;AAC5C,2BAA0B;AAC1B,+BAAoC;AAEpC,IAAI,kBAAQ,EAAE;IACV,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,SAAI,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;QAC/C,MAAM,MAAM,GAAG,cAAI,EAAE,CAAC;QACtB,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;IACH,YAAE,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE;QAChC,OAAO,CAAC,GAAG,CAAC,UAAU,MAAM,CAAC,OAAO,CAAC,GAAG,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;CACN;KAAM;IACH,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,EAAE;QAC3B,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,CAAC;QAEpB,MAAM,GAAG,GAAG,IAAI,yBAAW,EAAE,CAAC;QAC9B,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE;YACf,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;YAClC,mBAAY,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;CACN","file":"../cluster.js","sourcesContent":["import { isMaster, fork, on } from 'cluster';\nimport { Application } from './application';\nimport { cpus } from 'os';\nimport { createServer } from 'http';\n\nif (isMaster) {\n    Array.from({ length: cpus().length }).map((o, i) => {\n        const worker = fork();\n        worker.send({ id: i });\n    });\n    on('exit', (worker, code, signal) => {\n        console.log(`worker ${worker.process.pid} died`);\n    });\n} else {\n    process.on('message', (data) => {\n        const { id } = data;\n\n        const app = new Application();\n        app.bootstrap(() => {\n            console.log(`init worker: ${id}`);\n            createServer(app.callback()).listen(app.config.port);\n        });\n    });\n}\n"]}